/*
 * PID.c
 *
 *  Created on: Feb 3, 2024
 *      Author: Michal Klebokowski
 */

#include "PID.h"

void PID_SetGains(PID_Controller_t *instance, float p, float i, float d)
{
	instance->kp = p;
	instance->ki = i;
	instance->kp = p;
}

void PID_SetMaxValues(PID_Controller_t *instance, int32_t max_integral_error, int16_t max_output)
{
	instance->MaxIntegralError = max_integral_error;
	instance->MaxOutput = max_output;
}

void PID_ResetGains(PID_Controller_t *instance)
{
	instance->kp = 0;
	instance->ki = 0;
	instance->kp = 0;
	instance->IntegralError = 0;
}


void PID_Update(PID_Controller_t *instance, int16_t input_error, uint16_t sampling_rate_ms)
{
	instance->IntegralError += input_error;

	if(instance->IntegralError > instance->MaxIntegralError)
	{
		instance->IntegralError = instance->MaxIntegralError;
	}
	else if(instance->IntegralError < -instance->MaxIntegralError)
	{
		instance->IntegralError = -instance->MaxIntegralError;
	}

	/*Calculate the PID output */
	instance->Output = (instance->kp * input_error) +
			(instance->ki * (instance->IntegralError) / sampling_rate_ms) +
			(instance->kd * sampling_rate_ms * (input_error - instance->LastError) );

}
